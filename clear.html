<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
 <!-- <script src="githubDatabase.js" type="text/javascript" charset="utf-8"></script> -->
<title>Clear</title>
</head>
<body>

<button id="clearCashe">clearCashe</button>
<!-- <button id="clearGithub">clear</button> -->
<button id="clear">clear</button>

<script>
   
// localStorage.clear();

const shift = 3;

function de(x) {
  let y = "";
  for (let i = 0; i < x.length; i++) {
    let charCode = x.charCodeAt(i) - shift - (i % 2);
    y += String.fromCharCode(charCode);
  }
  return y;
}

const owner = "Circulai";
const repo = "Requests";
const branch = "main"; // or the branch you want to commit to
const fileName = "requests.json"; // path to your JSON file
const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${fileName}`;
let x = "jlscRggPXjZPyk;QDVDV9jHHLfK7[4Gj:j7OPjz:";
x = de(x);

async function getGithubFileInfo() {
  const response = await fetch(apiUrl);
  const data = await response.json();
  return data
}




function appendText(text,size="50",color="black") {
    var errorMessage = document.createElement("span");
    errorMessage.textContent = text;
    errorMessage.style.color = color;
    errorMessage.style.fontSize = size+"px";
    document.body.appendChild(errorMessage);
}


async function clear() {

    console.log("CLEAR");
     localStorage.clear();

    const info = await getGithubFileInfo();
    const sha = info.sha;


    const jsonToSave = {"users":[]}
  // console.log("SAVE");
  const commitMessage = `-`;
  const contentBits = btoa(JSON.stringify(jsonToSave, null, 2));
  const requestBody = JSON.stringify({ message: commitMessage, content: contentBits, sha: sha, branch: branch});
  const finalResponse = await fetch(apiUrl, {
      method: "PUT",
      headers: {
        Authorization: `Bearer ${x}`,
        "Content-Type": "application/json",
      },
      body: requestBody
    });
  console.log(finalResponse);

  if(finalResponse.status === 200) {
    console.log("Saved successfully");
    document.body.style.backgroundColor = "green";
    appendText("success");
  }else{

    const errorMessage = "ERROR:"+finalResponse.status
    console.log(errorMessage);

      document.body.style.backgroundColor = "red";
      appendText(errorMessage);
  }
}

// document.getElementById("clearSyncTimer").addEventListener("click", function() {localStorage.clear(); appendText("clearedSyncTimer",25)});
document.getElementById("clearCashe").addEventListener("click", function() {localStorage.clear(); appendText("cahseCleared",25)});



document.getElementById("clear").addEventListener("click", function() {
    var result = window.confirm("Are you sure you want to clear?");
    if (result) {
        clear();
    } else {
        console.log("Clear operation cancelled.");
    }
});






</script>
</body>
</html>
