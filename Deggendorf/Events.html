<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Events Deggendorf</title>
<meta property="og:title" content="Student Events Deggendorf" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://leanderziehm.github.io/Deggendorf/Events.html" />
<meta property="og:description" content="Events for Students at the THD. Sports, cinema and more.">
<meta property="og:image" content="https://leanderziehm.github.io/Deggendorf/images/OG1.jpg" />

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Events Deggendorf</title>
<script src="../test.js" type="text/javascript" charset="utf-8"></script>
<script src="eventsJson.js"></script>
<script src="main.js" type="text/javascript" charset="utf-8"></script>

</head>
<body>


<script>
    
//     // Array of font names
// const fonts = ["Arial", "Times New Roman", "Verdana", "Courier New", "Georgia"];

// // Index to keep track of the current font
// let currentFontIndex = 0;

// // Function to change the font
// function changeFont() {
//     document.body.style.fontFamily = fonts[currentFontIndex];
//     currentFontIndex = (currentFontIndex + 1) % fonts.length;
// }

// // Event listener for the 'e' key press
// document.addEventListener('keydown', function(event) {
//     if (event.key === 'e') {
//         changeFont();
//     }
// });

</script>

    <style>

    body {
        font-family: Verdana, sans-serif;
        background-color: rgb(0, 0, 0, 0.05);
        margin: 0;
        padding: 0;

    }

    button {
        border: none;
        border-radius: 50px;
        background-color: rgba(100, 100, 100, 0.5);
        /*color: rgba(255,255,255,1);*/
        color: rgba(0, 0, 0, 1);
        padding: 3px 10px;
    }




    #header{
        text-align: center;
         padding: 20px;
         margin: 0px;
         /*background-color: rgb(0, 0, 0, 0.05);*/

    }

     #eventsContainer {
        position: relative;
       
        border: none;
        flex-grow: 1;
        margin: 0px;
        padding: 0px;
    }


        #events{

    }


    @media (min-width: 768px) {
    #events {
        display: grid;
        grid-template-columns: repeat(3, 1fr); 
        gap: 0px; 
        }

    .event {
        width: auto; 
        }
    }


    .event {
        background-color: rgba(255, 255, 255, 1);
        /* margin-bottom: 20px; */
        padding: 10px;
        margin: 15px;
        border-radius: 20px;

        position: relative;


       
    }

    .details-container{
        margin-left: 20px;

        /* min-width: 500px; */
         /* put items in middle of div vertically */
        /* display: flex;
        flex-direction: column;
        justify-content: center;         1*/ 
    }

    .details-container *{
        padding: 2px;
        /* make non selectable  */
        user-select: none;
    }

    .event-title{
        margin-top: 10px;
        /* margin: 20px 0px 00px 0px; */
        /* padding-bottom: 10px;   1*/
        font-size: 24px;
        font-weight: bold;
    }
   
    .event-header {
        display: flex;
    }
    .event-title {
        font-size: 18px;
        font-weight: bold;
        /* background-color: yellow; */
    }

    .event-descriptionShort {
        display: none;
        font-size: 14px;
        /* background-color: lightblue; */
    }

    .event-location{
        display: none;
    }
    .event-date {
        /* transform: translate(0px, 15px); */
    }
    

    #thumbnail {
        border-radius: 20px;
        width: 200px; 
        aspect-ratio: 1;
        max-width: 30vw;
        max-height: 30vw;

        


        /* object-fit: cover; #no stretching but cuts of borders */
        /* object-fit: contain; # shows fill but adds transparent boderes at the side */
        /* object-fit: fill; # seems the same as default */
        /* object-fit: scale-down; shows all but borders */
        /* object-fit: none; #trash  */
        /* object-fit: inherit; */
        /* object-fit: initial; */
        /* object-fit: unset; */



        box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        /* centered and square */
        /* display: block;
        margin: auto; */


        /* make image keep it's aspect ratio
        max-width: 30vw; 
        max-height: 30vw; 
        width: auto;
        height: 150px;
        max-width: 100%; 
        max-height: 100%; 
        object-fit: contain;  */
    }
    .clickable {
        cursor: pointer;
    }
    .clickable:hover {
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5) !important;
    }




    
    .event-actions {
         display: none;
   
        /* background-color: red; */
        position: absolute;
        right: 40px;
        top: 40%;
        /*margin-top: 20px;*/
        /* transform: translateY(15px); */
    }
    .event-actions * img { 
         width: 30px;
        height: 30px;
   }

     /* .like img,
    .share img {
        width: 30px;
        height: 30px;
    } */

    .share,
    .like {
        background-color: transparent;
        padding: 10px;

    }
    .like{
        margin-right: 20px;
    }

    #likes {
        font-size: 30px;
    }

    #addEventBtn {
        display: none;
        background-color: rgb(138, 43, 226, 1);
        color: rgba(255, 255, 255, 1);
        padding: 10px;
        /* margin-left: 550px; */
        font-size: 20px;
        /* position: absolute; */
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
    }


    .event-language{
        /* display: none;    */
        position: absolute;
        right: 20px;
        bottom: 20px;
    }
    .event-price{
        position: absolute;
        right: 20px;
        bottom: 40px;
    }
   


   .filtes{
    /*display: inline-block;*/
    padding: 10px;
   }
    


    select{
        /*display: block;*/
        /* margin-left: auto; */
        /* margin-left: auto; */
        /* margin-right: 100px; Add space on the right side */
        margin-left: 20px;
        border-radius: 20px;
        padding: 15px 30px;
        border: none;
        font-weight: bold;
        font-size: 15px;
        background-color: white;
    }

    #dateFilter{
    }

    
    #langueSelect{
        /*display: none;*/
        position: absolute;
        top: 80px;
        right: 20px;
        z-index: 1000;
    
    }

    #deBtn img, #enBtn img {
    width: 40px;
    padding: 1px;
    border-radius: 10px;
    /* height: 30px; */

    
    }


        </style>


        <div id="langueSelect">
            <button id="deBtn"><img src="images/icons/de.png" ></button>
            <button id="enBtn"><img src="images/icons/us.png"></button>
        </div>

        <div id="eventsContainer">
            <h2 id="header" >Events Deggendorf</h2>

            <div class="filtes">
            
            <select id="dateFilter">
                <option value="any">Any Day</option>
                <option value="today">Today</option>
                <option value="tomorrow">Tomorrow</option>
                <option value="thisWeek">This Week</option>
                <option value="nextWeek">Next Week</option>
                <option value="thisMonth">This Month</option>
                <option value="nextMonth">Next Month</option>
            </select>

            <select id="categoryFilter">
                <option value="any">Any Category</option>
                <!-- <option value="sport">Sports</option>
                <option value="cinema">Cinema</option>
                <option value="international">International</option>
                <option value="special">Special</option> -->
            </select>


            <select id="typeFilter">
                <option value="any">Any Type</option>
                <option value="inPerson">In Person</option>
                <option value="online">Online</option>
            </select>

            <select id="priceFilter">
                <option value="any">Any Price</option>
                <option value="notFree">Not Free</option>
                <option value="free">Free</option>
            </select>

            <select id="languageFilter">
                <option value="any">Any Language</option>
                <option value="de">Deutsch</option>
                <option value="en">English</option>
            </select>


            </div>

           


            <div id="events"></div>


            <div style="display: flex; justify-content: center;">
                <div id="whatsappFeedback" >
                    <img id="thumbnail" src="images/icons/whatsapp.png">
                    <!-- <div style="color: white; font-weight: bold; font-size: 20px; " >Feedback</div> -->
                </div>
            </div>
 


            <button id="addEventBtn">+Add event </button>
        </div>
    </div>

    <script>






function main() {

    document.getElementById("whatsappFeedback").onclick = function () {
        window.open("https://chat.whatsapp.com/Bw7nlNAwJcBBZQuLFvtRWF");
    };
    

        // document.getElementById("toggleCollapseFilters").onclick = function () {

        //     const filters = document.getElementById("filters");
        //     const filterToggleBtn = document.getElementById("toggleCollapseFilters");

        //     const filtersCollapsed = filters.style.display === "none";

        //     if (filtersCollapsed) {
        //         filters.style.display = "block";
        //         filterToggleBtn.innerHTML = "‚óÄ";
                
        //     } else {
        //         filters.style.display = "none";
        //         filterToggleBtn.innerHTML = "üîç";
        //     }

        //     //set innerHTML of button to "+" or "X" depending on the state of the filters

        //     // document.getElementById("filters").classList.toggle("collapsed");
        //     // document.getElementById("filters").style.display = "none";

        // };
        const events = document.getElementById("events");

        const eventElementAndDateArray = [];
    for (var eventID = 0; eventID < eventsJson.length; eventID++) {
        let event = eventsJson[eventID];
        let eventHTML = createEventHTML(event, eventID);

        let  eventElement = document.createElement('div');
        eventElement.id = eventID;
        eventElement.className = "event";
        eventElement.innerHTML = eventHTML;

        if(event.timeEntry === undefined){
           eventElement.querySelector(".event-timeEntry").style.display = "none";
        }





        
        eventElement.querySelector("#time").innerHTML = getMyTimeString(eventID);



//////////////////
        

        const dateString = event.date;
        const dateInfo = calculateDateInfo(dateString);
        // console.log("dateInfo:", dateInfo);

        // const isWeekly = dateInfo["weekly"] !== undefined;

        // let eventDateHtml = `<span class="dateText">${dateInfo["dateText"]}</span>`;
        // if(isWeekly){
            // eventDateHtml += `<br/><span class="weekly">üîÅ weekly</span>`;
        // }

        // getEventDateHtml(dateInfo["date"]);

        //  eventElementAndDate.element.querySelector(".event-date").innerHTML = getEventDateHtml(dateInfo["dateText"]); 
         eventElement.querySelector(".event-date").innerHTML = getEventDateHtml(event.date); 

        // eventElement.querySelector(".event-date").innerHTML = eventDateHtml;


        const date = dateInfo["date"];

        //add start time to date
        const timeStart = event.timeStart;
        if(timeStart !== undefined){
            const timeParts = timeStart.split(":");
            date.setHours(timeParts[0]);
            date.setMinutes(timeParts[1]);
        }

        const timeEntry = event.timeEntry;
        if(timeEntry !== undefined){
            //set timeEntry to date
            const timeEntryParts = timeEntry.split(":");
            date.setHours(timeEntryParts[0]);
            date.setMinutes(timeEntryParts[1]);

        }



        const eventIsInFuture = date > new Date();

        const eventIsOnSameDay = date.toDateString() === new Date().toDateString();

        // console.log("eventIsInFuture:", eventIsInFuture, "date:", date, "new Date():", new Date(),"eventIsOnSameDay:", eventIsOnSameDay)

        if(eventIsInFuture || eventIsOnSameDay){
             eventElementAndDateArray.push({ date: date, element: eventElement, "dateString": dateInfo["dateString"] });
        }
       

        if(event.descriptionShort == "" || event.descriptionShort == undefined){
             eventElement.querySelector(".event-descriptionShort").style.display = "none";
        }
    }



    const DISABLE_SORTING_BY_DATE_FOR_DEBUGGING = false;
    //sort events by date
    if(!DISABLE_SORTING_BY_DATE_FOR_DEBUGGING){
          eventElementAndDateArray.sort((a, b) => a.date - b.date);
    }
  


    eventElementAndDateArray.forEach((eventElementAndDate) => {
        events.appendChild(eventElementAndDate.element);
    });




    function getEventDateHtml(date){
        const dateInfo = calculateDateInfo(date);
        const isWeekly = dateInfo["weekly"] !== undefined;

        let dateText = dateInfo["dateText"];
        //remove year from dateText
        dateText = dateText.replace(new Date().getFullYear() + "", "").replace(new Date().getFullYear() + "", ""); // removes 2024
        //how can I remove all occurences of a substring in a string?
        // Answer = dateText.replace(/2024/g, ""); // removes all occurences of 2024
        
        let eventDateHtml = `<span class="dateText">${dateText}</span>`;
        if (isWeekly) {
            eventDateHtml += `<br/><span class="weekly">üîÅ weekly</span>`;
        }
        return eventDateHtml;
    }


    
    function onLanguageChange(language) {
        console.log("Language changed to: ", language);
            eventElementAndDateArray.forEach((eventElementAndDate) => {
                eventElementAndDate.element.querySelector(".event-date").innerHTML = getEventDateHtml(eventElementAndDate["dateString"]);                
            });


    }





    function addFilterOnChange(checkIfPassesFilterCallback,id,eventKeyName){

        const filterElement = document.getElementById(id);

        filterElement.onchange = function () {
        eventElementAndDateArray.forEach((eventElementAndDate) => {
            const passesFilter = checkIfPassesFilterCallback(eventElementAndDate,eventKeyName, filterElement.value);
            if (passesFilter) {
                eventElementAndDate.element.style.display = "block";
            } else {
                eventElementAndDate.element.style.display = "none";
            }
        });
    };

    }


        function checkIfPassesDateFilter(eventElementAndDate,eventKeyName, filterText) {

            currentDate = new Date();
            eventDate = eventElementAndDate.date;

            switch (filterText) {
                case "today":
                    return eventDate.toDateString() === currentDate.toDateString();
                case "tomorrow":
                    const tomorrow = new Date(currentDate);
                    tomorrow.setDate(currentDate.getDate() + 1);
                    return eventDate.toDateString() === tomorrow.toDateString();
                case "thisWeek":
                    const thisWeekStart = new Date(currentDate);
                    const thisWeekEnd = new Date(currentDate);
                    const dayOfWeek = currentDate.getDay();
                    const diff = currentDate.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // adjust when day is Sunday
                    thisWeekStart.setDate(diff);
                    thisWeekEnd.setDate(diff + 6);
                    return eventDate >= thisWeekStart && eventDate <= thisWeekEnd;
                case "nextWeek":
                    const nextWeekStart = new Date(currentDate);
                    nextWeekStart.setDate(currentDate.getDate() + 7 - currentDate.getDay());
                    const nextWeekEnd = new Date(nextWeekStart);
                    nextWeekEnd.setDate(nextWeekStart.getDate() + 6);
                    return eventDate >= nextWeekStart && eventDate <= nextWeekEnd;
                case "thisMonth":
                    return eventDate.getMonth() === currentDate.getMonth() && eventDate.getFullYear() === currentDate.getFullYear();
                case "nextMonth":
                    const nextMonthStart = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
                    const nextMonthEnd = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 0);
                    return eventDate >= nextMonthStart && eventDate <= nextMonthEnd;
                case "any":
                default:
                    return true; // No filtering
            }
        }


        function checkIfPassesFilter(eventElementAndDate,eventKeyName ,filterText) {
            let eventID = eventElementAndDate.element.id;
            eventID = parseInt(eventID);
            const event = eventsJson[eventID];
            const eventValue = event[eventKeyName];

            if(filterText == 'any'){
                return true;
            }
            else if (filterText == eventValue){
                return true;
            }else{
                return false;
            }
        }



        // document.getElementById("categoryFilter");
        // add dynamic categories all found in the eventsJson   
        const categories = [];
        eventsJson.forEach((event) => {
            if (!categories.includes(event.category)) {
                categories.push(event.category);
            }
        });
        const categoryFilter = document.getElementById("categoryFilter");
        categories.forEach((category) => {
            const option = document.createElement("option");
            option.value = category;
            const capitalizedCategory = category.charAt(0).toUpperCase() + category.slice(1);
            option.innerHTML = capitalizedCategory;
            // option.innerHTML = category;
            categoryFilter.appendChild(option);
        });

    

        
    // addFilterOnChange(checkIfPassesDateFilter,'dateFilter');
    addFilterOnChange(checkIfPassesFilter,'categoryFilter','category');
    // addFilterOnChange(checkIfPassesFilter,'typeFilter','type','NEEDS CUSOM FOR HYBRID!!!!');
    // addFilterOnChange(checkIfPassesFilter,'priceFilter','price');
    // addFilterOnChange(checkIfPassesFilter,'languageFilter','language','NEEDS CUSOM!!!!'); 

    // hide every commented filter 

    document.getElementById("dateFilter").style.display = "none";
    document.getElementById("typeFilter").style.display = "none";
    document.getElementById("priceFilter").style.display = "none";
    document.getElementById("languageFilter").style.display = "none";


    

    // console.log("HI")
   clickedLanguage(getLanguage());



   




//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////






    
        const eventElements = document.querySelectorAll(".event");
        eventElements.forEach((element) => {
            element.querySelector(".like").onclick = function () {

                const likeSpan = element.querySelector("#likes");
                const currentLikeText= likeSpan.innerHTML;
                //like text is empty at the start
                let currentLikes = 0;
                if(currentLikeText !== ""){
                    currentLikes = parseInt(currentLikeText);
                }
                likeSpan.innerHTML = currentLikes + 1;
            };
            element.querySelector(".share").onclick = function () {
                alert("Share");
            };

            const eventLanguageElement = element.querySelector(".event-language");
            const eventLanguage = eventLanguageElement.innerHTML;
            if(eventLanguage === "de"){
                eventLanguageElement.innerHTML = "üá©üá™";
            }else if(eventLanguage === "en"){
                eventLanguageElement.innerHTML = "üá∫üá∏";
            }else if(eventLanguage === "de+en"){
                eventLanguageElement.innerHTML = "üá©üá™ üá∫üá∏";
            }


        });

    document.getElementById("deBtn").addEventListener("click", function () {
        clickedLanguage('de');
    });

    document.getElementById("enBtn").addEventListener("click", function () {
        clickedLanguage('en');
    });

        function clickedLanguage(languageToSet) {

            console.log("clicked:", languageToSet);

            if (languageToSet === "de") {
                document.getElementById("deBtn").style.backgroundColor = "rgb(138, 43, 226, 1)";
                document.getElementById("enBtn").style.backgroundColor = "rgba(255, 255, 255, 1)";
            } else if (languageToSet === "en") {
                document.getElementById("enBtn").style.backgroundColor = "rgb(138, 43, 226, 1)";
                document.getElementById("deBtn").style.backgroundColor = "rgba(255, 255, 255, 1)";
            }

            if(languageToSet !== getLanguage()){
                setLanguage(languageToSet);
                onLanguageChange(languageToSet);
            }
    }



       
        document.getElementById("addEventBtn").onclick = function () {
            window.location.href = "Event.html?event=new";
        };

    document.querySelectorAll(".clickable").forEach((element) => {
        element.onclick = function () {
            window.location.href = "Event.html?event=" + element.parentElement.parentElement.id;
        };

        element.setAttribute('draggable', false);
    });





    const queryParams = new URLSearchParams(window.location.search);
    const eventParameter = queryParams.get('event');

    if (eventParameter == 'new') {
        // document.getElementById('event-name').innerHTML = "New Event";

    } else {
        // console
        const eventIDScrollTo = eventParameter;
        const element = document.getElementById(eventIDScrollTo);


        if (element) {
            const elementPosition = element.getBoundingClientRect().top;
            const possitionToScroll = elementPosition - 200;
            window.scrollTo({
                top: possitionToScroll
                // behavior: 'smooth' // Optionally, you can use 'smooth' for smooth scrolling
            });
        }


    }

    // remove all query parameters from the url
    window.history.replaceState({}, document.title, window.location.pathname);
    

     
}
















    function createEventHTML(event, index) {
            let eventHTML = `
            <div class="event-header">
                 <img class="clickable"  id="thumbnail" src="images/${index}/${event.images[0]}" alt="img">
                
                <div class="details-container clickable" >
                    <div class="event-title">${event.name}</div>
                    <div class="event-descriptionShort">${event.descriptionShort} </div>
                    <div class="event-date"></div>
                    <div class="event-timeEntry">üö™ ${event.timeEntry}</div>
                    <div id="time"></div>
                    <div class="event-location">${event.location.name}</div>
                    <div class="event-price">${event.price}</div>
                    <div class="event-language">${event.language}</div>

                </div>
                <div class="event-actions">
                    <span id="likes"></span>
                    <button class="like"><img src="images/icons/love.png" alt="Like"></button>
                    <button class="share"><img src="images/icons/share.png" alt="Share"></button>
                </div>
            </div>
  
    `;
            return eventHTML;
        }



document.addEventListener("DOMContentLoaded", main);
</script>
</body>

</html>


